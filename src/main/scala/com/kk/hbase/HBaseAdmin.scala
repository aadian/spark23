package com.kk.hbase

import java.io.{FileWriter, File, IOException}
import java.net.URI
import java.util

import com.kk.util.HDFSHelper
import org.apache.hadoop.conf.Configuration
import org.apache.hadoop.fs.FileSystem
import org.apache.hadoop.hbase._
import org.apache.hadoop.hbase.client._
import org.apache.hadoop.hbase.util.Bytes
import org.apache.hadoop.mapred.JobConf
import org.apache.spark._
import org.apache.spark.sql.SparkSession
import org.apache.commons.lang3.StringUtils
import java.util.{Arrays, ArrayList}
import scala.collection.mutable.ListBuffer

/**
  * @Auther: leiying
  * @Date: 2018/8/10 17:04
  * @Description:
  */

class ThreadReadHbase() extends Thread {
  override def run() {
    //    addRecord("ly_test","001","c","name","Kevin")
    val nameValue = "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"




    for (i <- 1 to 200000) {
      val rowKey = StringUtils.rightPad("rowKey" + i, 12, "0")
      HBaseAdmin.addRecord("ly_test", rowKey, "c", "name", nameValue)
      Thread.sleep(10)
    }

    //Thread.sleep(500)
  }
}

class ThreadReadFile extends Thread {

  def subDir(dir: File): Iterator[File] = {
    val dirs = dir.listFiles().filter(_.isDirectory())
    val files = dir.listFiles().filter(_.isFile())
    files.toIterator ++ dirs.toIterator.flatMap(subDir _)
  }


  override def run(): Unit = {
    val dirname = "/Develop/hbase_store/data/default/ly_test/14cbb15be3766d7fdf377a75d7d5df0c/c"
    val dir = new File(dirname)

    while (true) {

      try {
        val fileIter = subDir(dir)
        var fileNum = 0
        var fileSize:Long = 0
        while (fileIter.hasNext) {
          val file = fileIter.next()
          fileNum += 1
          fileSize += file.length().toLong
          //println("file Name:" + file.getName + ":" + file.length())
        }
        val currentTime = System.currentTimeMillis()
        println("file Number," + currentTime + "," + fileNum)
        println("file Accumumicate Size," + currentTime + "," + fileSize)



      } catch {
        case e: Exception => println(e.toString)
      }

      Thread.sleep(500)
    }


  }
}

class ThreadGetAdminInfo extends Thread {

  val conf = HBaseConfiguration.create()


  //设置zooKeeper集群地址，也可以通过将hbase-site.xml导入classpath，但是建议在程序里这样设置
  conf.set("hbase.zookeeper.quorum", "localhost")
  //设置zookeeper连接端口，默认2181
  conf.set("hbase.zookeeper.property.clientPort", "2181")

  val connection = ConnectionFactory.createConnection(conf);
  val admin = connection.getAdmin();


  override def run(): Unit = {


    while (true) {
      val clusterStatus = admin.getClusterStatus
      val serverIterator = clusterStatus.getServers.iterator()
      while (serverIterator.hasNext) {
        val serverName = serverIterator.next()
        val serverLoad = clusterStatus.getLoad(serverName)
        val regLoadIt = serverLoad.getRegionsLoad.entrySet().iterator()
        while (regLoadIt.hasNext) {
          val regLoad = regLoadIt.next()
          val tableName = Bytes.toString(regLoad.getKey).split(",")(0)
          if (tableName.equalsIgnoreCase("ly_test")) {
            println("MemStoreSize," + System.currentTimeMillis() + "," + regLoad.getValue.getMemStoreSizeMB())
          }
        }


      }

      Thread.sleep(500)
    }


  }


}

object HBaseAdmin {


  val conf = HBaseConfiguration.create()


  //设置zooKeeper集群地址，也可以通过将hbase-site.xml导入classpath，但是建议在程序里这样设置
  conf.set("hbase.zookeeper.quorum", "localhost")
  //设置zookeeper连接端口，默认2181
  conf.set("hbase.zookeeper.property.clientPort", "2181")

  //val tableName = "ly_test"
  val tableName = "PHERF.USER_DEFINED_TEST"
  val logOutPath = "./output/"
  //val cf = "c"
  var cf = "0"


  //hdfs目录上的路径，不同的nameservicer对应的会不一样  hdfs://nameservice1/hbase/data/default/PHERF.USER_DEFINED_TEST/
  //val hbaseDataPath: String = "/Develop/hbase-1.2.6-src/hbase_store/data/default/" + tableName
  var hbaseDataPath = "hdfs://nameservice1/hbase/data/default/" + tableName


  def main(args: Array[String]): Unit = {

    //    val spark = SparkSession.builder().master("local").appName("HBase Admin").getOrCreate()
    //    val sparkConf = new SparkConf().setAppName("HBaseTest").setMaster("local")
    //    val sc = new SparkContext(sparkConf)


    dropTable(tableName)
    createTable(tableName, cf)


    //数据写入
    new ThreadWriteHbase(tableName).start()


    //获取表对应的文件数，大小
    new ThreadGetTableInfo(hbaseDataPath, logOutPath, tableName).start()


    //获取配置文件信息
    //getHBaseConf()


    //dropTable("ly_test")

    println("hello hbase")
  }

  /**
    * 获取hbase的配置
    */
  def getHBaseConf(): Unit = {
    val connection = ConnectionFactory.createConnection(conf);
    val hbaseConf = connection.getConfiguration
    println(hbaseConf.getStrings("hbase.hregion.memstore.flush.size")(0)) //134217728
    println(hbaseConf.getStrings("hbase.hregion.max.filesize")(0)) //10737418240
    println(hbaseConf.getStrings("hbase.regionserver.msginterval")(0)) //3000
    println(hbaseConf.getStrings("hbase.master.info.port")(0)) //16010
    println(hbaseConf.getStrings("hbase.regionserver.region.split.policy")(0)) //IncreasingToUpperBoundRegionSplitPolicy
    println(hbaseConf.getStrings("hbase.hregion.memstore.block.multiplier")(0)) //4
    println(hbaseConf.getStrings("hbase.hregion.memstore.flush.size")(0)) //4
    //println(hbaseConf.getStrings("hbase.hstore.defaultengine.compactionpolicy.class")(0))


    val tableDesc = new HTableDescriptor(TableName.valueOf("ly_test"))
    val cfs = tableDesc.getColumnFamilies

    val table = connection.getTable(TableName.valueOf("ly_test"))
    import scala.collection.JavaConversions._
    for (family <- table.getTableDescriptor.getFamilies) {
      println("cf:" + family.getNameAsString)
    }

    println("getMemStoreFlushSize:" + tableDesc.getMemStoreFlushSize)



    //println(hbaseConf.getStrings("hbase.regionserver.global.memstore.upperLimit")(0))
    //    println(hbaseConf.getStrings("hbase.hstore.compaction.min.size")(0))
    //    println(hbaseConf.getStrings("hbase.hregion.max.filesize")(0))

    //println(hbaseConf.getStrings("hbase.hstore.compaction.ratio")(0)) //10
    //println(hbaseConf.getStrings("hbase.increasing.policy.initial.size")(0)) //100


  }


  /**
    * 创建表，和列族，并设置表的Split Policy
    *
    * @param tablename
    * @param columnFamily
    */
  def createTable(tablename: String, columnFamily: String): Unit = {

    val connection = ConnectionFactory.createConnection(conf);
    val admin = connection.getAdmin();
    val tableNameObj = TableName.valueOf(tablename);

    if (admin.tableExists(tableNameObj)) {
      System.out.println("Table exists!");
      System.exit(0);
    } else {
      val tableDesc = new HTableDescriptor(TableName.valueOf(tablename));
      tableDesc.addFamily(new HColumnDescriptor(columnFamily));
      //tableDesc.setValue(HTableDescriptor.SPLIT_POLICY, "org.apache.hadoop.hbase.regionserver.ConstantSizeRegionSplitPolicy")
      tableDesc.setValue(HTableDescriptor.SPLIT_POLICY, "org.apache.hadoop.hbase.regionserver.IncreasingToUpperBoundRegionSplitPolicy")
      admin.createTable(tableDesc);
      println("create table success!");
    }

    admin.close();
    connection.close();

  }

  def getAdminInfo(): Unit = {
    val connection = ConnectionFactory.createConnection(conf);
    val admin = connection.getAdmin();

    import org.apache.hadoop.hbase.util.Bytes
    val clusterStatus = admin.getClusterStatus

    //    println("clusterStatus.getServersSize:" + clusterStatus.getServersSize)
    //    println("clusterStatus.getRegionsCount:" + clusterStatus.getRegionsCount)
    //    println("clusterStatus.getAverageLoad:" + clusterStatus.getAverageLoad)
    //    println("===========================")
    //    println()


    val serverIterator = clusterStatus.getServers.iterator()
    while (serverIterator.hasNext) {
      val serverName = serverIterator.next()
      //      println("server name:" + serverName)
      //      println("===========================")
      //      println()

      val serverLoad = clusterStatus.getLoad(serverName)
      //      println("server's getReadRequestsCount:" + serverLoad.getReadRequestsCount)
      //      println("server's getWriteRequestsCount:" + serverLoad.getWriteRequestsCount)
      //      println("server's getRequestsPerSecond:" + serverLoad.getRequestsPerSecond)
      //      println("===========================")
      //      println()

      val regLoadIt = serverLoad.getRegionsLoad.entrySet().iterator()
      while (regLoadIt.hasNext) {
        val regLoad = regLoadIt.next()
        val tableName = Bytes.toString(regLoad.getKey).split(",")(0)
        println("nothing")
        if (tableName.equalsIgnoreCase("ly_test")) {
          //println("tableName:" + tableName)
          println(System.currentTimeMillis() + "," + regLoad.getValue.getMemStoreSizeMB())

          //println("region:" + Bytes.toString(regLoad.getKey))
          //          println("region mem store size:" + regLoad.getValue.getMemStoreSizeMB())
          //          println("===========================")
          //          println()
        }

        //        println("region's getReadRequestsCount" + regLoad.getValue.getReadRequestsCount)
        //        println("region's getWriteRequestsCount" + regLoad.getValue.getWriteRequestsCount)
        //        println("region's getRequestsCount" + regLoad.getValue.getRequestsCount)
        //        println("===========================")
        //        println()
      }


    }

    //    for (serverName <- clusterStatus.getServers()) {
    //      val serverLoad = clusterStatus.getLoad(serverName)
    //      println("serverName:" + serverName)
    //      //      for (regionload <- serverLoad.getRegionsLoad.entrySet) {
    //      //        val regionName = Bytes.toString(regionload.)
    //      //        result.put(regionName, regionload.getValue)
    //      //      }
    //    }


  }


  /**
    * 删除表
    *
    * @param tableName 需要删除的表名
    */
  def dropTable(tableName: String): Unit = {

    val connection = ConnectionFactory.createConnection(conf);
    val admin = connection.getAdmin();
    val table = TableName.valueOf(tableName);

    try {
      admin.disableTable(table)
      admin.deleteTable(table)
      println("delete table " + tableName + "ok.")
    } catch {
      case e: IOException => println(e)
    }

  }


  /**
    * 往表中增加记录
    */
  def addRecord(tableName: String): Unit = {

    val nameValue = "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111" +
      "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"


    try {
      val connection = ConnectionFactory.createConnection(conf)
      val table = connection.getTable(TableName.valueOf(tableName))

      for (i <- 1 to 200000) {
        val rowKey = StringUtils.rightPad("rowKey" + i, 12, "0")
        //HBaseAdmin.addRecord("ly_test", rowKey, "c", "name", nameValue)
        val put = new Put(Bytes.toBytes(rowKey))
        put.addColumn(Bytes.toBytes("c"), Bytes.toBytes("name"), Bytes.toBytes(nameValue))
        table.put(put)

        Thread.sleep(5)

        val delete = new Delete(Bytes.toBytes(rowKey));
        table.delete(delete)


        Thread.sleep(5)
      }


      table.close
      connection.close()
      //println("insert recored " + rowKey + " to table " + tableName + "ok.")
    } catch {
      case e: IOException =>
        e.printStackTrace()
    }
  }

}

class ThreadWriteHbase(tableName: String) extends Thread {
  override def run() {
    HBaseAdmin.addRecord(tableName)
  }
}


/**
  * 获取表的信息，并将对应信息写入日志文件
  *
  * @param outputBasePath 日志文件的目录
  * @param testTableName  表名
  */
class ThreadGetTableInfo(hbaseDataPath: String, outputBasePath: String, testTableName: String) extends Thread {

  //使用map存储日志文件，新创建的文件存储在此数据结构中
  var fileMap: Map[String, FileWriter] = Map()

  val conf = HBaseConfiguration.create()


  //设置zooKeeper集群地址，也可以通过将hbase-site.xml导入classpath，但是建议在程序里这样设置
  conf.set("hbase.zookeeper.quorum", "localhost")
  //设置zookeeper连接端口，默认2181
  conf.set("hbase.zookeeper.property.clientPort", "2181")

  val connection = ConnectionFactory.createConnection(conf);
  val admin = connection.getAdmin();


  override def run(): Unit = {

    while (true) {
      val clusterStatus = admin.getClusterStatus
      val serverIterator = clusterStatus.getServers.iterator()
      while (serverIterator.hasNext) {
        //服务名称
        val serverName = serverIterator.next()
        val serverLoad = clusterStatus.getLoad(serverName)
        val regLoadIt = serverLoad.getRegionsLoad.entrySet().iterator()

        while (regLoadIt.hasNext) {
          val regLoad = regLoadIt.next()
          //获取表名
          val tableName = Bytes.toString(regLoad.getKey).split(",")(0)

          //如果是需要监控的数据表
          if (tableName.equalsIgnoreCase(testTableName)) {
            //获取region名称
            val regionName = Bytes.toString(regLoad.getKey).split("\\.")(1)
            println("RegionName:" + regionName + "," + System.currentTimeMillis() + ",MemStoreSize:" + regLoad.getValue.getMemStoreSizeMB())

            //当前region的Memstore大小
            logMemSize(regionName, regLoad.getValue.getMemStoreSizeMB)

            //获取此表的列族
            val table = connection.getTable(TableName.valueOf(tableName))
            val familyNames = new ArrayList[String]
            import scala.collection.JavaConversions._
            for (family <- table.getTableDescriptor.getFamilies) {
              familyNames.add(family.getNameAsString)
            }

            //通过region名称和列族名称，获取region等相关信息
            getRegionFileInfo(hbaseDataPath, regionName, familyNames)
          }
        }


      }

      Thread.sleep(500)
    }


  }

  /**
    * 记录MemStore的大小
    *
    * @param regionName
    * @param memStoreSize
    */
  def logMemSize(regionName: String, memStoreSize: Long): Unit = {
    val stringArr = Arrays.asList("MemStoreSize", regionName)
    val actualFileName = StringUtils.join(stringArr.toArray, '_')
    println("actualFileName:" + actualFileName)
    if (fileMap.contains(actualFileName)) {
      val out = fileMap.get(actualFileName).get
      out.write("[" + System.currentTimeMillis() + "," + memStoreSize / (1024 * 1024) + "],\n")
      out.flush()
    } else {
      val out = new FileWriter(outputBasePath + actualFileName + ".txt", true)
      fileMap += (actualFileName -> out)
      out.write("[" + System.currentTimeMillis() + "," + memStoreSize / (1024 * 1024) + "],\n")
      out.flush()
    }
  }


  /**
    * 记录单个列族下单个文件的大小
    *
    * @param regionName region名称
    * @param cfName     列族名称
    * @param fileName   列族对应的文件名称
    * @param fileSize   文件大小
    */
  def logFileSize(regionName: String, cfName: String, fileName: String, fileSize: Long): Unit = {

    //构造字符串数组，并用下划线连接起来，从而构造日志文件名称
    val stringArr = Arrays.asList("FileSize", regionName, cfName, fileName)
    val actualFileName = StringUtils.join(stringArr.toArray, '_')

    //如果文件已经存在，直接写入文件内容
    if (fileMap.contains(actualFileName)) {
      val out = fileMap.get(actualFileName).get
      out.write("[" + System.currentTimeMillis() + "," + fileSize / (1024 * 1024) + "],\n")

      out.flush()
    } else {
      //如果文件不存在，先创建文件再写入文件内容

      val out = new FileWriter(outputBasePath + actualFileName + ".txt", true)
      fileMap += (actualFileName -> out)
      out.write("[" + System.currentTimeMillis() + "," + fileSize / (1024 * 1024) + "],\n")
      out.flush()

    }

    //memStore_RegionName_Size	filesize_fileName_RegionName_CF_Size	fileNum_fileName_Region_CF_Number
  }

  /**
    * 记录region单个列族的文件数量
    *
    * @param regionName region名称
    * @param cfName     列族名称
    * @param fileNum    文件数量
    */
  def logFileNum(regionName: String, cfName: String, fileNum: Int): Unit = {

    //构造字符串数组，并用下划线连接起来，从而构造日志文件名称
    val stringArr = Arrays.asList("FileNum", regionName, cfName)
    val actualFileName = StringUtils.join(stringArr.toArray, '_')

    //如果文件已经存在，直接写入文件内容
    if (fileMap.contains(actualFileName)) {
      val out = fileMap.get(actualFileName).get
      out.write("[" + System.currentTimeMillis() + "," + fileNum + "],\n")

      out.flush()
    } else {
      //如果文件不存在，先创建文件再写入文件内容
      val out = new FileWriter(outputBasePath + actualFileName + ".txt", true)
      fileMap += (actualFileName -> out)
      out.write("[" + System.currentTimeMillis() + "," + fileNum + "],\n")
      out.flush()
    }

  }

  /**
    * 记录region对应列族所有文件大小
    *
    * @param regionName
    * @param cfName
    * @param fileTotalSize
    */

  def logFileTotalSizer(regionName: String, cfName: String, fileTotalSize: Long): Unit = {

    val stringArr = Arrays.asList("FileTotalSize", regionName, cfName)
    val actualFileName = StringUtils.join(stringArr.toArray, '_')

    //文件已经创建
    if (fileMap.contains(actualFileName)) {
      val out = fileMap.get(actualFileName).get
      out.write("[" + System.currentTimeMillis() + "," + fileTotalSize / (1024 * 1024) + "],\n")

      out.flush()
    } else {

      val out = new FileWriter(outputBasePath + actualFileName + ".txt", true)
      fileMap += (actualFileName -> out)
      out.write("[" + System.currentTimeMillis() + "," + fileTotalSize / (1024 * 1024) + "],\n")
      out.flush()
    }


  }


  /**
    * 获取region对应列族的信息
    *
    * @param regionName
    * @param familiyNames
    */
  def getRegionFileInfo(hbaseDataPath: String, regionName: String, familiyNames: java.util.ArrayList[String]): Unit = {
    //val dirname = "E:\\spark\\hbase-1.2.6\\store\\data\\default\\ly_test\\" + regionName + "\\c"


    try {

      import scala.collection.JavaConversions._
      for (familyName <- familiyNames) {

        val dirname = hbaseDataPath + File.separator + regionName + File.separator + familyName
        val dir = new File(dirname)
        val fileIter = subDir(dir)
        var fileNum = 0
        var fileTotalSize: Long = 0

        //便利列族在hdfs下的文件
        while (fileIter.hasNext) {
          val file = fileIter.next()
          //每个文件输出单个文件的大小
          println("RegionName:" + regionName + "," + System.currentTimeMillis() + ",familyName:" + familyName + ",FileName:" + file.getName + ",FileSize:" + file.length().toLong / (1024 * 1024))
          logFileSize(regionName, familyName, file.getName, file.length())
          fileNum += 1
          fileTotalSize += file.length().toLong
        }

        //每个列族输出列族文件数量
        println("RegionName:" + regionName + "," + System.currentTimeMillis() + ",familyName:" + familyName + ",FileNum:" + fileNum)
        logFileNum(regionName, familyName, fileNum)
        //每个列族输出所有文件的大小
        println("RegionName:" + regionName + "," + System.currentTimeMillis() + ",familyName:" + familyName + ",FileTotalSize:" + fileTotalSize)
        logFileTotalSizer(regionName, familyName, fileTotalSize)

      }
    } catch {
      case e: Exception =>
        e.printStackTrace()
        println(e.toString)
    }


  }


  def subDir(dir: File): Iterator[File] = {
    val dirs = dir.listFiles().filter(_.isDirectory())
    val files = dir.listFiles().filter(_.isFile())
    files.toIterator ++ dirs.toIterator.flatMap(subDir _)
  }

  def hdfsSubDir(): ListBuffer[String] = {

    val conf = new Configuration()
    val lb = new ListBuffer[String]
    val fs = FileSystem.get(URI.create("hdfs://nameservice1/"), conf)

    val lbChildFiles = HDFSHelper.listChildren(fs, "/KLSparkApp/data", lb)

    println(lbChildFiles.iterator.length)

    lbChildFiles

  }


}